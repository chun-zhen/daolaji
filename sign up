#include <SPI.h>
#include <MFRC522.h>//读取卡号部分
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>//oled部分
 
#define SS_PIN 10
#define RST_PIN 9//设置RFID模块
 
MFRC522 mfrc522(SS_PIN, RST_PIN); //实例化类

// 初始化数组用于存储读取到的NUID 
byte nuidPICC[4];

#define OLED_RESET 4
Adafruit_SSD1306 display(OLED_RESET);
 
#define LOGO16_GLCD_HEIGHT 16 //定义显示高度
#define LOGO16_GLCD_WIDTH  16 //定义显示宽度

 //中文：王 （这就是存储点阵变量，str_1可以修改成自己喜欢的名称，用函数display.drawBitmap（）调用就可以了）
static const unsigned char PROGMEM str_1[] =
{ 
0x00,0x00,0x7F,0xFC,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x3F,0xF8,
0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0xFF,0xFE,0x00,0x00
  };
 
//中文：瑞
static const unsigned char PROGMEM str_2[] =
{ 
0x00,0x20,0x02,0x22,0xFA,0x22,0x22,0x22,0x23,0xFE,0x20,0x00,0x27,0xFE,0xF8,0x20,
0x20,0x40,0x23,0xFE,0x22,0x52,0x3A,0x52,0xE2,0x52,0x42,0x52,0x02,0x52,0x02,0x06
  };
 
//中文：琪
static const unsigned char PROGMEM str_3[] =
{ 
0x01,0x08,0x01,0x08,0xFB,0xFC,0x21,0x08,0x21,0x08,0x21,0xF8,0x21,0x08,0xF9,0x08,
0x21,0xF8,0x21,0x08,0x21,0x08,0x3B,0xFE,0xE0,0x00,0x40,0x90,0x01,0x08,0x02,0x04
  };

//中文：甄
static const unsigned char PROGMEM str_4[] =
{ 
0x00,0x00,0xFE,0xFC,0x28,0x40,0x28,0x40,0xFE,0x40,0xAA,0x78,0xAA,0x48,0xFE,0x48,
0x10,0xA8,0x10,0x98,0xFE,0x88,0x10,0x88,0x10,0xAA,0x1E,0xCA,0xF0,0x8A,0x40,0x06
  };
 
//中文：琪
static const unsigned char PROGMEM str_5[] =
{ 
0x01,0x08,0x01,0x08,0xFB,0xFC,0x21,0x08,0x21,0x08,0x21,0xF8,0x21,0x08,0xF9,0x08,
0x21,0xF8,0x21,0x08,0x21,0x08,0x3B,0xFE,0xE0,0x00,0x40,0x90,0x01,0x08,0x02,0x04
  };

//oled显示部分
 
void setup() { 
  Serial.begin(9600);
  while (!Serial);    
  SPI.begin(); // 初始化SPI总线
  mfrc522.PCD_Init();    // Init MFRC522
  mfrc522.PCD_DumpVersionToSerial();  // Show details of PCD - MFRC522 Card Reader details
  Serial.println(F("Scan PICC to see UID, SAK, type, and data blocks..."));
}
 
void loop() {
 
  // 找卡
  if ( ! mfrc522.PICC_IsNewCardPresent())
    return;
 
  // 验证NUID是否可读
  if ( ! mfrc522.PICC_ReadCardSerial())
    return;

  
  // 将NUID保存到nuidPICC数组
  for (byte i = 0; i < 4; i++) {
    nuidPICC[i] =  mfrc522.uid.uidByte[i];
  }   
  
  // 使放置在读卡区的IC卡进入休眠状态，不再重复读卡
  mfrc522.PICC_HaltA();
 
  // 停止读卡模块编码
 mfrc522.PCD_StopCrypto1();
  
  if (nuidPICC[0]==0x21&&nuidPICC[1]==0xD7&&nuidPICC[2]==0xC7&&nuidPICC[3]==0xEF)//注意要把卡号分成4部分
  {
    display.begin(SSD1306_SWITCHCAPVCC, 0x3C);  // initialize with the I2C addr 0x3D (for the 128x64)
  // init done
display.clearDisplay();//清屏
display.drawBitmap(0, 0, str_4, 16, 16, 1);//在坐标X:26  Y:16的位置显示中文字符甄
  display.drawBitmap(16, 0, str_5, 16, 16, 1);//在坐标X:42  Y:16的位置显示中文字符琪
  display.display();                  //把缓存的都显示
    delay(1000);
  }
  else if(nuidPICC[0]==0x39&&nuidPICC[1]==0xC5&&nuidPICC[2]==0xF1&&nuidPICC[3]==0x79)//39 C5 F1 79
 {
   display.begin(SSD1306_SWITCHCAPVCC, 0x3C);  // initialize with the I2C addr 0x3D (for the 128x64)
  // init done
 display.clearDisplay();//清屏
 display.drawBitmap(0, 0, str_1, 16, 16, 1); //在坐标X:26  Y:16的位置显示中文字符王
 display.drawBitmap(16, 0, str_2, 16, 16, 1); //在坐标X:42  Y:16的位置显示中文字符瑞
 display.drawBitmap(32, 0, str_3, 16, 16, 1);//显示中文字符琪
 delay(1000);
  }
else{
   Serial.print("非用户，无法确认");
   delay(1000);
  }
}
